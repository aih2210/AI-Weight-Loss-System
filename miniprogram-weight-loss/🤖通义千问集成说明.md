# 🤖 通义千问AI集成说明

## 功能概述

AI助手已集成阿里云通义千问大模型，提供更智能、更个性化的减重建议。

## 主要特性

✅ **双模式支持**
- 通义千问AI模式：真实AI对话，智能回答
- 本地知识库模式：离线可用，快速响应

✅ **个性化建议**
- 基于用户体重数据提供定制建议
- 考虑减重进度和目标
- 专业友好的回答风格

✅ **智能功能**
- 实时AI对话
- 正在输入动画
- API调用失败自动降级到本地模式
- 快捷问题一键提问

## 使用步骤

### 1. 获取通义千问API Key

1. 访问阿里云官网：https://www.aliyun.com
2. 搜索"通义千问"或"DashScope"
3. 开通服务（新用户有免费额度）
4. 创建API Key并复制

### 2. 在小程序中设置API Key

1. 打开AI助手页面
2. 点击右上角的 ⚙️ 设置按钮
3. 输入你的API Key
4. 点击确定保存

### 3. 开始使用

- 设置完成后自动切换到AI模式
- 输入问题即可获得AI回答
- 可随时切换本地/AI模式

## 配置说明

### 微信小程序域名配置

由于微信小程序的安全限制，需要在小程序后台配置合法域名：

1. 登录微信小程序后台
2. 进入"开发" -> "开发管理" -> "开发设置"
3. 在"服务器域名"中添加：
   - request合法域名：`https://dashscope.aliyuncs.com`

### API参数说明

```javascript
{
  model: 'qwen-turbo',        // 使用qwen-turbo模型（快速且经济）
  max_tokens: 800,            // 最大回复长度
  temperature: 0.7            // 创造性程度（0-1，越高越有创意）
}
```

可选模型：
- `qwen-turbo`：快速响应，适合日常对话
- `qwen-plus`：更强大，回答更详细
- `qwen-max`：最强大，但费用较高

## 功能说明

### 顶部状态栏
- 🤖 显示当前使用的AI模式
- ❓ 查看API Key获取指南
- ⚙️ 设置API Key

### 聊天功能
- 实时AI对话
- 正在输入动画提示
- 消息时间戳
- 聊天记录保存

### 快捷操作
- 🗑️ 清空聊天记录
- 🔄 切换AI/本地模式

## 费用说明

通义千问采用按量计费：
- 新用户有免费额度
- qwen-turbo：约 ¥0.002/千tokens
- 日常使用成本很低

## 注意事项

⚠️ **重要提示**

1. **API Key安全**
   - 不要分享你的API Key
   - 定期更换API Key
   - 如果泄露，立即在阿里云后台删除

2. **网络要求**
   - AI模式需要网络连接
   - 网络不佳时会自动降级到本地模式
   - 本地模式完全离线可用

3. **小程序配置**
   - 必须配置合法域名才能调用API
   - 开发时可以在开发者工具中勾选"不校验合法域名"

## 技术实现

### API调用流程

```
用户输入 → 构建提示词 → 调用通义千问API → 返回AI回答
                ↓ (失败)
            本地知识库回答
```

### 系统提示词

AI助手会自动获取用户信息并构建个性化提示词：
- 用户姓名
- 当前体重
- 目标体重
- 减重进度

### 错误处理

- API调用失败自动降级到本地模式
- 显示友好的错误提示
- 不影响用户体验

## 常见问题

**Q: API Key在哪里保存？**
A: 保存在微信小程序的本地存储中，只在你的设备上。

**Q: 可以不使用AI模式吗？**
A: 可以，点击"切换到本地"即可使用离线知识库。

**Q: AI回答不准确怎么办？**
A: 可以尝试：
- 更详细地描述问题
- 切换到本地模式查看预设建议
- 调整API参数（需修改代码）

**Q: 费用会很高吗？**
A: 不会，日常使用成本很低，新用户还有免费额度。

## 更新日志

### v1.0 (2024-12-27)
- ✅ 集成通义千问API
- ✅ 双模式支持（AI/本地）
- ✅ API Key管理
- ✅ 个性化提示词
- ✅ 错误处理和降级
- ✅ 正在输入动画

## 技术支持

如有问题，请检查：
1. API Key是否正确
2. 网络连接是否正常
3. 小程序域名是否配置
4. 阿里云账户余额是否充足

---

**享受智能AI助手带来的个性化减重体验！** 🎉
