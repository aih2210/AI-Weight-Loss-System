<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="card">
    <view class="user-header">
      <view class="avatar-container" bindtap="showAvatarPicker">
        <image wx:if="{{avatarUrl && avatarUrl.indexOf('/') > -1}}" class="avatar-image" src="{{avatarUrl}}" mode="aspectFill" />
        <view wx:else class="avatar-emoji">{{avatarUrl || '👤'}}</view>
        <view class="avatar-edit-badge">✏️</view>
      </view>
      <view class="user-info">
        <view class="user-name">{{userData.user.name}}</view>
        <view class="user-desc">{{userData.user.age}}岁 · {{userData.user.gender === 'male' ? '男' : '女'}} · {{userData.user.height}}cm</view>
      </view>
    </view>
    
    <view class="stats-grid">
      <view class="stat-box">
        <view class="stat-value" style="color: #a8d08d;">{{streak}}</view>
        <view class="stat-label">连续打卡</view>
      </view>
      <view class="stat-box">
        <view class="stat-value" style="color: #ff9800;">{{weightLost}}</view>
        <view class="stat-label">已减重(kg)</view>
      </view>
      <view class="stat-box">
        <view class="stat-value" style="color: #2196f3;">{{daysUsed}}</view>
        <view class="stat-label">使用天数</view>
      </view>
    </view>
  </view>

  <!-- 功能列表 -->
  <view class="card">
    <view class="list-item" bindtap="showEditProfile">
      <view class="list-icon">👤</view>
      <view class="list-content">
        <view class="list-title">个人资料</view>
      </view>
      <text class="arrow">›</text>
    </view>
    <view class="list-item" bindtap="showGoalSettings">
      <view class="list-icon">🎯</view>
      <view class="list-content">
        <view class="list-title">目标设置</view>
      </view>
      <text class="arrow">›</text>
    </view>
    <view class="list-item" bindtap="goToWeightUpdate">
      <view class="list-icon">⚖️</view>
      <view class="list-content">
        <view class="list-title">更新体重</view>
      </view>
      <text class="arrow">›</text>
    </view>
    <view class="list-item" bindtap="goToDataManagement">
      <view class="list-icon">💾</view>
      <view class="list-content">
        <view class="list-title">数据管理</view>
      </view>
      <text class="arrow">›</text>
    </view>
  </view>

  <!-- 账号与设置 -->
  <view class="card">
    <view class="section-title">账号与设置</view>
    <view class="list-item" bindtap="goToAccountManagement">
      <view class="list-icon">🔐</view>
      <view class="list-content">
        <view class="list-title">账号管理</view>
        <view class="list-desc">登录、注册、账号安全</view>
      </view>
      <text class="arrow">›</text>
    </view>
    <view class="list-item" bindtap="goToPrivacySettings">
      <view class="list-icon">🔒</view>
      <view class="list-content">
        <view class="list-title">隐私设置</view>
        <view class="list-desc">数据隐私、权限管理</view>
      </view>
      <text class="arrow">›</text>
    </view>
    <view class="list-item" bindtap="goToNotificationSettings">
      <view class="list-icon">🔔</view>
      <view class="list-content">
        <view class="list-title">通知设置</view>
        <view class="list-desc">提醒、推送管理</view>
      </view>
      <text class="arrow">›</text>
    </view>
    <view class="list-item" bindtap="showAbout">
      <view class="list-icon">ℹ️</view>
      <view class="list-content">
        <view class="list-title">关于应用</view>
      </view>
      <text class="arrow">›</text>
    </view>
  </view>
</view>

<!-- 头像选择弹窗 -->
<view wx:if="{{showAvatarOptions}}" class="modal" bindtap="hideAvatarPicker">
  <view class="modal-content avatar-modal" catchtap="stopPropagation">
    <view class="modal-title">选择头像</view>
    
    <!-- Emoji头像选择 -->
    <view class="avatar-section">
      <view class="section-label">Emoji头像</view>
      <view class="emoji-grid">
        <view 
          class="emoji-item" 
          wx:for="{{avatarEmojis}}" 
          wx:key="*this"
          data-emoji="{{item}}"
          bindtap="selectEmojiAvatar">
          {{item}}
        </view>
      </view>
    </view>

    <!-- 相册选择 -->
    <view class="avatar-section">
      <view class="section-label">从相册选择</view>
      <button class="image-picker-btn" bindtap="chooseImageAvatar">
        📷 选择图片
      </button>
    </view>

    <button class="cancel-button full-width" bindtap="hideAvatarPicker">取消</button>
  </view>
</view>

<!-- 编辑个人资料弹窗 -->
<view wx:if="{{showEditModal}}" class="modal" bindtap="hideEditModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-title">编辑个人资料</view>
    
    <view class="form-item">
      <view class="label">姓名</view>
      <input class="input-field" placeholder="请输入姓名" value="{{editName}}" bindinput="onNameInput" />
    </view>

    <view class="form-item">
      <view class="label">年龄</view>
      <input class="input-field" type="number" placeholder="请输入年龄" value="{{editAge}}" bindinput="onAgeInput" />
    </view>

    <view class="form-item">
      <view class="label">身高（cm）</view>
      <input class="input-field" type="number" placeholder="请输入身高" value="{{editHeight}}" bindinput="onHeightInput" />
    </view>

    <view class="form-item">
      <view class="label">性别</view>
      <picker mode="selector" range="{{genderOptions}}" value="{{editGender}}" bindchange="onGenderChange">
        <view class="picker-display">{{genderOptions[editGender]}}</view>
      </picker>
    </view>

    <view class="button-group">
      <button class="cancel-button" bindtap="hideEditModal">取消</button>
      <button class="submit-button" bindtap="saveProfile">保存</button>
    </view>
  </view>
</view>

<!-- 目标设置弹窗 -->
<view wx:if="{{showGoalModal}}" class="modal" bindtap="hideGoalModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-title">目标设置</view>
    
    <view class="form-item">
      <view class="label">目标体重（kg）</view>
      <input class="input-field" type="digit" placeholder="请输入目标体重" value="{{targetWeight}}" bindinput="onTargetWeightInput" />
    </view>

    <view class="form-item">
      <view class="label">每日卡路里目标（kcal）</view>
      <input class="input-field" type="number" placeholder="建议1200-1800" value="{{dailyCalorieTarget}}" bindinput="onCalorieTargetInput" />
      <view class="hint-text">建议：女性1200-1500，男性1500-1800</view>
    </view>

    <view class="form-item">
      <view class="label">每日运动目标（kcal）</view>
      <input class="input-field" type="number" placeholder="建议200-500" value="{{dailyExerciseTarget}}" bindinput="onExerciseTargetInput" />
      <view class="hint-text">建议：初学者200-300，进阶者300-500</view>
    </view>

    <view class="button-group">
      <button class="cancel-button" bindtap="hideGoalModal">取消</button>
      <button class="submit-button" bindtap="saveGoals">保存</button>
    </view>
  </view>
</view>
