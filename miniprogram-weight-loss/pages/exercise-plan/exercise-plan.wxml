<!--pages/exercise-plan/exercise-plan.wxml-->
<view class="container">
  <!-- æœ€å°å¯è¡Œæ–¹æ¡ˆæç¤º -->
  <view wx:if="{{showMinimalPlan}}" class="minimal-plan-card">
    <view class="minimal-header">
      <view class="minimal-title">ğŸ’ª é‡æ–°å¼€å§‹</view>
      <view class="close-btn" bindtap="closeMinimalPlan">Ã—</view>
    </view>
    <view class="minimal-content">
      <view class="encouragement">{{minimalPlanData.encouragement}}</view>
      <view class="minimal-plan-info">
        <view class="plan-name">{{minimalPlanData.minimalPlan.name}}</view>
        <view class="plan-duration">åªéœ€ {{minimalPlanData.minimalPlan.duration}} åˆ†é’Ÿ</view>
      </view>
      <button class="btn-minimal" bindtap="showMinimalPlanDetail">æŸ¥çœ‹è¯¦æƒ…</button>
    </view>
  </view>

  <!-- å½“å‰è®¡åˆ’ -->
  <view wx:if="{{hasActivePlan}}" class="active-plan-section">
    <!-- é¢„æœŸæ•ˆæœ -->
    <view class="card results-card">
      <view class="card-title">ğŸ“Š é¢„æœŸæ•ˆæœ</view>
      <view class="results-grid">
        <view class="result-item">
          <view class="result-value">{{expectedResults.trainingDays}}</view>
          <view class="result-label">è®­ç»ƒå¤©æ•°/å‘¨</view>
        </view>
        <view class="result-item">
          <view class="result-value">{{expectedResults.totalCalories}}</view>
          <view class="result-label">æ€»æ¶ˆè€—/å‘¨</view>
        </view>
        <view class="result-item">
          <view class="result-value">{{expectedResults.expectedWeightLoss}}</view>
          <view class="result-label">é¢„æœŸå‡é‡(kg)</view>
        </view>
      </view>
      <view class="result-desc">{{expectedResults.description}}</view>
    </view>

    <!-- å‘¨è®¡åˆ’ -->
    <view class="card">
      <view class="card-title">ğŸ“… æœ¬å‘¨è®¡åˆ’</view>
      <view class="weekly-plan">
        <view 
          class="day-card {{item.isRestDay ? 'rest-day' : 'training-day'}}" 
          wx:for="{{weeklyPlan}}" 
          wx:key="dayIndex"
          bindtap="viewDayPlan"
          data-day="{{item}}">
          
          <view class="day-header">
            <view class="day-name">{{item.day}}</view>
            <view wx:if="{{!item.isRestDay}}" class="day-badge">{{item.focus}}</view>
            <view wx:else class="rest-badge">ä¼‘æ¯</view>
          </view>

          <view wx:if="{{!item.isRestDay}}" class="day-info">
            <view class="info-row">
              <text class="info-icon">â±ï¸</text>
              <text class="info-text">{{item.totalTime}}åˆ†é’Ÿ</text>
            </view>
            <view class="info-row">
              <text class="info-icon">ğŸ”¥</text>
              <text class="info-text">{{item.totalCalories}}å¡</text>
            </view>
          </view>

          <view wx:if="{{!item.isRestDay}}" class="activities-preview">
            <view class="activity-tag" wx:for="{{item.activities}}" wx:key="name" wx:for-item="activity">
              {{activity.name}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="btn-secondary" bindtap="adjustPlan">ğŸ”„ è°ƒæ•´è®¡åˆ’</button>
      <button class="btn-danger" bindtap="deletePlan">ğŸ—‘ï¸ åˆ é™¤è®¡åˆ’</button>
    </view>
  </view>

  <!-- ç”Ÿæˆæ–°è®¡åˆ’ -->
  <view wx:else class="new-plan-section">
    <view class="card">
      <view class="card-title">ğŸ¯ ç”Ÿæˆä¸ªæ€§åŒ–è¿åŠ¨è®¡åˆ’</view>
      <view class="card-desc">æ ¹æ®ä½ çš„ä½“èƒ½ã€æ—¶é—´å’Œç›®æ ‡ï¼ŒAIå°†ä¸ºä½ å®šåˆ¶ä¸“å±è®¡åˆ’</view>
    </view>

    <!-- ä½“èƒ½æ°´å¹³ -->
    <view class="card">
      <view class="form-label">ğŸ’ª ä½“èƒ½æ°´å¹³</view>
      <picker mode="selector" range="{{fitnessLevels}}" value="{{fitnessLevel}}" bindchange="onFitnessLevelChange">
        <view class="picker-view">{{fitnessLevels[fitnessLevel]}}</view>
      </picker>
    </view>

    <!-- å¯ç”¨æ—¶é—´ -->
    <view class="card">
      <view class="form-label">â±ï¸ æ¯æ¬¡å¯ç”¨æ—¶é—´</view>
      <picker mode="selector" range="{{timeOptions}}" value="{{selectedTimeIndex}}" bindchange="onTimeChange">
        <view class="picker-view">{{timeOptions[selectedTimeIndex]}} åˆ†é’Ÿ</view>
      </picker>
    </view>

    <!-- è¿åŠ¨åå¥½ -->
    <view class="card">
      <view class="form-label">â¤ï¸ è¿åŠ¨åå¥½ï¼ˆå¯å¤šé€‰ï¼‰</view>
      <view class="tag-grid">
        <view 
          class="tag-item {{item.selected ? 'selected' : ''}}" 
          wx:for="{{preferenceList}}" 
          wx:key="name"
          bindtap="togglePreference"
          data-pref="{{item.name}}">
          {{item.name}}
        </view>
      </view>
    </view>

    <!-- å¯ç”¨è®¾å¤‡ -->
    <view class="card">
      <view class="form-label">ğŸ‹ï¸ å¯ç”¨è®¾å¤‡ï¼ˆå¯å¤šé€‰ï¼‰</view>
      <view class="tag-grid">
        <view 
          class="tag-item {{item.selected ? 'selected' : ''}}" 
          wx:for="{{equipmentList}}" 
          wx:key="name"
          bindtap="toggleEquipment"
          data-equip="{{item.name}}">
          {{item.name}}
        </view>
      </view>
    </view>

    <!-- ç”ŸæˆæŒ‰é’® -->
    <button class="btn-primary" bindtap="generatePlan">
      ğŸ¤– ç”ŸæˆAIè¿åŠ¨è®¡åˆ’
    </button>

    <!-- è¯´æ˜ -->
    <view class="card tips-card">
      <view class="card-title">ğŸ’¡ åŠŸèƒ½è¯´æ˜</view>
      <view class="tips-text">
        â€¢ AIæ ¹æ®ä½ çš„æƒ…å†µç”Ÿæˆä¸ªæ€§åŒ–è®¡åˆ’\n
        â€¢ è®¡åˆ’ä¼šæ ¹æ®å®Œæˆæƒ…å†µè‡ªåŠ¨è°ƒæ•´\n
        â€¢ è¿ç»­é”™è¿‡è®­ç»ƒæ—¶æä¾›æœ€å°å¯è¡Œæ–¹æ¡ˆ\n
        â€¢ ä¸è¦æ±‚å®Œç¾ï¼Œåªè¦å¼€å§‹å°±æ˜¯èƒœåˆ©
      </view>
    </view>
  </view>
</view>
