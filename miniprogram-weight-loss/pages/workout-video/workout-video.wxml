<!--pages/workout-video/workout-video.wxml-->
<view class="container" wx:if="{{plan}}">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="header-card">
    <view class="workout-title">{{plan.day}} - {{plan.focus}}</view>
    <view class="workout-meta">
      <view class="meta-item">
        <text class="meta-icon">â±ï¸</text>
        <text class="meta-text">{{plan.totalTime}}åˆ†é’Ÿ</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ”¥</text>
        <text class="meta-text">{{plan.totalCalories}}å¡</text>
      </view>
    </view>
  </view>

  <!-- è¿›åº¦æ¡ -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">è¿›åº¦ï¼š{{currentActivityIndex + 1}}/{{plan.activities.length}}</text>
      <text class="progress-percent">{{Math.round((currentActivityIndex / plan.activities.length) * 100)}}%</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{(currentActivityIndex / plan.activities.length) * 100}}%"></view>
    </view>
  </view>

  <!-- å½“å‰åŠ¨ä½œ -->
  <view class="current-activity-card">
    <view class="activity-header">
      <view class="activity-name">{{currentActivity.name}}</view>
      <view class="activity-type">{{currentActivity.type === 'cardio' ? 'æœ‰æ°§' : currentActivity.type === 'strength' ? 'åŠ›é‡' : currentActivity.type === 'warmup' ? 'çƒ­èº«' : 'æ”¾æ¾'}}</view>
    </view>
    
    <!-- è§†é¢‘åŒºåŸŸ -->
    <view class="video-section">
      <view class="video-placeholder" bindtap="playVideo">
        <view class="play-icon">â–¶</view>
        <view class="play-text">ç‚¹å‡»æ’­æ”¾æ•™å­¦è§†é¢‘</view>
      </view>
    </view>

    <!-- å€’è®¡æ—¶ -->
    <view class="timer-section">
      <view class="timer-display">{{formatTime(remainingTime)}}</view>
      <view class="timer-label">å‰©ä½™æ—¶é—´</view>
    </view>

    <!-- åŠ¨ä½œæè¿° -->
    <view class="activity-description">
      <view class="desc-title">ğŸ“‹ åŠ¨ä½œè¯´æ˜</view>
      <view class="desc-content">{{currentActivity.description}}</view>
      <button class="btn-detail" bindtap="viewActivityDetail">æŸ¥çœ‹è¯¦ç»†è¦ç‚¹</button>
    </view>
  </view>

  <!-- æ§åˆ¶æŒ‰é’® -->
  <view class="control-buttons">
    <view wx:if="{{!isPlaying}}" class="btn-row">
      <button class="btn-primary btn-large" bindtap="startWorkout">
        ğŸƒ å¼€å§‹è®­ç»ƒ
      </button>
    </view>
    
    <view wx:else class="btn-row">
      <button wx:if="{{!isPaused}}" class="btn-warning btn-large" bindtap="pauseWorkout">
        â¸ï¸ æš‚åœ
      </button>
      <button wx:else class="btn-success btn-large" bindtap="resumeWorkout">
        â–¶ï¸ ç»§ç»­
      </button>
    </view>

    <view class="btn-row btn-row-secondary">
      <button class="btn-secondary" bindtap="skipActivity">
        â­ï¸ è·³è¿‡
      </button>
      <button class="btn-secondary" bindtap="playVideo">
        ğŸ¥ è§†é¢‘
      </button>
      <button class="btn-danger" bindtap="exitWorkout">
        âŒ é€€å‡º
      </button>
    </view>
  </view>

  <!-- è®­ç»ƒåˆ—è¡¨ -->
  <view class="activities-list-card">
    <view class="card-title">ğŸ“ è®­ç»ƒåˆ—è¡¨</view>
    <view class="activities-list">
      <view 
        class="activity-item {{index === currentActivityIndex ? 'current' : ''}} {{completedActivities.includes(index) ? 'completed' : ''}}"
        wx:for="{{plan.activities}}"
        wx:key="name">
        <view class="activity-number">{{index + 1}}</view>
        <view class="activity-info">
          <view class="activity-name-small">{{item.name}}</view>
          <view class="activity-duration">{{item.duration}}åˆ†é’Ÿ</view>
        </view>
        <view class="activity-status">
          <text wx:if="{{completedActivities.includes(index)}}">âœ“</text>
          <text wx:elif="{{index === currentActivityIndex}}">â–¶</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è®­ç»ƒæç¤º -->
  <view class="tips-card">
    <view class="card-title">ğŸ’¡ è®­ç»ƒæç¤º</view>
    <view class="tips-list">
      <view class="tip-item">â€¢ ä¿æŒå‘¼å¸é¡ºç•…ï¼Œä¸è¦æ†‹æ°”</view>
      <view class="tip-item">â€¢ åŠ¨ä½œè´¨é‡æ¯”æ•°é‡æ›´é‡è¦</view>
      <view class="tip-item">â€¢ æ„Ÿè§‰ä¸é€‚ç«‹å³åœæ­¢</view>
      <view class="tip-item">â€¢ è®­ç»ƒåè®°å¾—æ‹‰ä¼¸æ”¾æ¾</view>
    </view>
  </view>
</view>

<wxs module="Math">
  var round = function(num) {
    return Math.round(num);
  };
  module.exports = {
    round: round
  };
</wxs>
