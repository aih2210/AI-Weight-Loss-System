# 💾 数据管理功能说明

## ✅ 已完成功能

### 1. 数据统计
- ✅ 实时显示各类数据数量
- ✅ 饮食记录统计
- ✅ 运动记录统计
- ✅ 情绪记录统计
- ✅ 体重记录统计
- ✅ 总记录数统计
- ✅ 存储空间显示

### 2. 数据导出
- ✅ 导出为JSON格式
- ✅ 包含所有用户数据
- ✅ 复制到剪贴板
- ✅ 显示数据大小
- ✅ 导出时间戳

### 3. 数据导入
- ✅ 从剪贴板导入
- ✅ JSON格式验证
- ✅ 数据完整性检查
- ✅ 导入前确认
- ✅ 导入后重启提示

### 4. 本地备份
- ✅ 一键备份所有数据
- ✅ 显示备份时间
- ✅ 备份状态指示
- ✅ 快速恢复功能
- ✅ 删除备份功能

### 5. 数据清除
- ✅ 清除所有数据
- ✅ 二次确认机制
- ✅ 危险操作警告
- ✅ 自动重启应用

---

## 📱 使用指南

### 访问入口

1. 打开小程序
2. 点击底部"我的"标签
3. 点击"数据管理"
4. 进入数据管理页面

### 页面布局

```
数据管理
├── 📊 数据统计
│   ├── 饮食记录数
│   ├── 运动记录数
│   ├── 情绪记录数
│   ├── 体重记录数
│   └── 存储大小
├── 数据操作
│   ├── 📤 导出数据
│   └── 📥 导入数据
├── 备份与恢复
│   ├── 💾 立即备份
│   ├── 🔄 恢复备份
│   └── 🗑️ 删除备份
└── ⚠️ 危险操作
    └── 清除所有数据
```

---

## 🔧 功能详解

### 1. 数据统计

**显示内容**：
- 🥗 饮食记录：X 条
- 💪 运动记录：X 条
- 😊 情绪记录：X 条
- ⚖️ 体重记录：X 条
- 总计：X 条记录
- 存储大小：X KB/MB

**查看详情**：
点击"查看详细信息"按钮，显示：
- 用户基本信息
- 各类记录统计
- 存储空间占用

---

### 2. 导出数据

**操作步骤**：
1. 点击"导出数据"
2. 系统准备数据（显示加载）
3. 显示导出预览对话框
4. 点击"复制数据"
5. 数据复制到剪贴板
6. 显示保存提示

**导出格式**：
```json
{
  "version": "1.0",
  "exportTime": "2025-12-27T08:00:00.000Z",
  "data": {
    "user": { ... },
    "weightHistory": [ ... ],
    "foodLogs": [ ... ],
    "exerciseLogs": [ ... ],
    "emotionLogs": [ ... ],
    "settings": { ... }
  }
}
```

**保存方法**：
1. 打开备忘录或文本编辑器
2. 粘贴数据（长按 → 粘贴）
3. 保存文件
4. 建议文件名：`weight-loss-data-2025-12-27.json`

**注意事项**：
- ✅ 数据包含所有记录
- ✅ 格式为标准JSON
- ✅ 可在其他设备导入
- ⚠️ 包含个人隐私，请妥善保管

---

### 3. 导入数据

**操作步骤**：
1. 准备JSON数据文件
2. 复制文件内容到剪贴板
3. 点击"导入数据"
4. 系统读取剪贴板
5. 验证数据格式
6. 显示确认对话框
7. 确认导入
8. 导入完成，提示重启

**数据验证**：
- ✅ 检查JSON格式
- ✅ 验证版本号
- ✅ 检查数据结构
- ❌ 格式错误会提示

**导入效果**：
- ⚠️ 当前数据会被覆盖
- ✅ 所有记录会被替换
- ✅ 设置会被更新
- 💡 建议先备份当前数据

**错误处理**：
- 格式错误：提示数据格式不正确
- 版本不匹配：提示版本问题
- 数据损坏：提示数据无效

---

### 4. 本地备份

#### 立即备份

**操作步骤**：
1. 点击"立即备份"
2. 系统保存当前数据
3. 记录备份时间
4. 显示"备份成功"

**备份内容**：
- 所有用户数据
- 所有记录
- 所有设置

**备份位置**：
- 存储在本地Storage
- Key: `dataBackup`
- 不占用额外空间

**备份时机**：
- 💡 重要操作前（如导入、清除）
- 💡 定期备份（建议每周）
- 💡 更新数据后

#### 恢复备份

**操作步骤**：
1. 点击"恢复备份"
2. 显示备份时间
3. 确认恢复
4. 系统恢复数据
5. 自动重启应用

**恢复效果**：
- ⚠️ 当前数据会被覆盖
- ✅ 恢复到备份时的状态
- ✅ 所有记录恢复
- ✅ 设置恢复

**注意事项**：
- 只能恢复最近一次备份
- 恢复后无法撤销
- 建议先导出当前数据

#### 删除备份

**操作步骤**：
1. 点击"删除备份"
2. 确认删除
3. 备份数据被删除
4. 备份状态更新

**删除原因**：
- 释放存储空间
- 不需要备份
- 备份数据过旧

---

### 5. 清除所有数据

**操作步骤**：
1. 点击"清除所有数据"
2. 第一次确认（显示警告）
3. 第二次确认（最后确认）
4. 系统清除所有数据
5. 恢复初始状态
6. 自动重启应用

**清除内容**：
- ❌ 所有饮食记录
- ❌ 所有运动记录
- ❌ 所有情绪记录
- ❌ 所有体重记录
- ❌ 所有设置
- ❌ 所有备份

**警告信息**：
```
⚠️ 危险操作

确定要清除所有数据吗？

此操作将：
• 删除所有记录
• 删除所有设置
• 恢复到初始状态

⚠️ 此操作不可恢复！
```

**使用场景**：
- 重新开始
- 清理测试数据
- 转让设备前
- 数据损坏修复

---

## 🎨 界面设计

### 数据统计卡片

```
┌─────────────────────────────────┐
│ 📊 数据统计          128KB      │
├─────────────────────────────────┤
│  🥗        💪                    │
│  45        32                    │
│  饮食记录   运动记录              │
│                                 │
│  😊        ⚖️                    │
│  28        15                    │
│  情绪记录   体重记录              │
├─────────────────────────────────┤
│  总计              120 条记录    │
├─────────────────────────────────┤
│  [查看详细信息]                  │
└─────────────────────────────────┘
```

### 数据操作

```
┌─────────────────────────────────┐
│ 数据操作                        │
├─────────────────────────────────┤
│ 📤 导出数据                  ›  │
│    将所有数据导出为JSON格式      │
│                                 │
│ 📥 导入数据                  ›  │
│    从JSON文件导入数据            │
└─────────────────────────────────┘
```

### 备份与恢复

```
┌─────────────────────────────────┐
│ 备份与恢复                      │
├─────────────────────────────────┤
│ 上次备份                        │
│ 2025-12-27 15:30      ✓ 已备份 │
├─────────────────────────────────┤
│ 💾 立即备份                  ›  │
│    备份当前所有数据到本地        │
│                                 │
│ 🔄 恢复备份                  ›  │
│    从备份恢复数据                │
│                                 │
│ 🗑️ 删除备份                  ›  │
│    删除本地备份数据              │
└─────────────────────────────────┘
```

---

## 💡 使用技巧

### 1. 定期备份

**建议频率**：
- 每周备份一次
- 重要操作前备份
- 数据量大时备份

**备份策略**：
```
周一：立即备份
周五：导出数据（保存到云盘）
```

### 2. 数据迁移

**换设备流程**：
1. 旧设备：导出数据
2. 保存JSON文件到云盘
3. 新设备：安装小程序
4. 复制JSON数据
5. 导入数据
6. 验证数据完整性

### 3. 数据安全

**保护措施**：
- 定期导出数据
- 保存多个备份
- 云盘存储
- 加密存储（可选）

### 4. 故障恢复

**数据丢失**：
1. 检查本地备份
2. 恢复备份数据
3. 如无备份，从导出文件导入

**数据损坏**：
1. 尝试恢复备份
2. 如无效，清除所有数据
3. 从导出文件重新导入

---

## 🔍 常见问题

### Q1: 导出的数据在哪里？
**A**: 数据复制到剪贴板，需要手动粘贴到备忘录或文本编辑器保存。

### Q2: 可以导出到文件吗？
**A**: 小程序限制无法直接保存文件，需要通过剪贴板复制。

### Q3: 备份和导出有什么区别？
**A**: 
- 备份：存储在本地，快速恢复，只保留最新一次
- 导出：复制到剪贴板，可保存多个版本，可跨设备

### Q4: 导入会覆盖当前数据吗？
**A**: 是的，导入会完全覆盖当前数据。建议先备份或导出当前数据。

### Q5: 备份数据会占用空间吗？
**A**: 会占用一定空间，但通常很小（几十到几百KB）。

### Q6: 可以恢复到某个历史版本吗？
**A**: 本地备份只保留最新一次。如需多版本，请使用导出功能保存多个文件。

### Q7: 清除数据后能恢复吗？
**A**: 不能！清除是永久性的。务必先备份或导出数据。

### Q8: 数据格式是什么？
**A**: 标准JSON格式，可用任何文本编辑器查看和编辑。

---

## 🚀 高级用法

### 1. 批量编辑数据

1. 导出数据
2. 用文本编辑器打开
3. 编辑JSON数据
4. 保存并复制
5. 导入回小程序

### 2. 数据分析

1. 导出数据
2. 用Python/Excel分析
3. 生成图表和报告

### 3. 多设备同步

1. 设备A导出数据
2. 上传到云盘
3. 设备B下载数据
4. 导入到设备B

### 4. 数据备份策略

**3-2-1原则**：
- 3份数据：原始 + 本地备份 + 导出文件
- 2种介质：手机 + 云盘
- 1份异地：云盘存储

---

## 📊 数据结构

### 完整数据结构

```json
{
  "version": "1.0",
  "exportTime": "2025-12-27T08:00:00.000Z",
  "data": {
    "user": {
      "name": "张三",
      "age": 25,
      "gender": "male",
      "height": 175,
      "currentWeight": 70,
      "targetWeight": 65,
      "startWeight": 75,
      "startDate": "2025-01-01"
    },
    "weightHistory": [
      {
        "weight": 75,
        "date": "2025-01-01",
        "timestamp": 1704067200000
      }
    ],
    "foodLogs": [
      {
        "id": 1704067200000,
        "name": "早餐",
        "calories": 300,
        "date": "2025-01-01",
        "timestamp": 1704067200000
      }
    ],
    "exerciseLogs": [
      {
        "id": 1704067200000,
        "name": "跑步",
        "duration": 30,
        "calories": 200,
        "date": "2025-01-01",
        "timestamp": 1704067200000
      }
    ],
    "emotionLogs": [
      {
        "id": 1704067200000,
        "mood": "开心",
        "moodValue": "happy",
        "date": "2025-01-01",
        "timestamp": 1704067200000
      }
    ],
    "settings": {
      "dailyCalorieTarget": 1500,
      "dailyExerciseTarget": 300,
      "reminderEnabled": true
    }
  }
}
```

---

## ⚠️ 注意事项

### 数据安全
- ✅ 定期备份数据
- ✅ 导出重要数据
- ✅ 妥善保管导出文件
- ⚠️ 不要分享给他人（包含隐私）

### 操作安全
- ⚠️ 导入前先备份
- ⚠️ 清除前先导出
- ⚠️ 确认操作再执行
- ⚠️ 二次确认很重要

### 存储限制
- 小程序存储限制：10MB
- 建议定期清理旧数据
- 导出后可删除历史记录

---

**版本**：v1.0
**更新时间**：2025-12-27
**状态**：✅ 已完成并测试
