# 📸 真实AI食物识别 - 配置指南

## 🎯 功能升级

食物识别功能已升级为**真实的AI图像识别**，使用通义千问视觉模型（qwen-vl-plus）实现准确的食物识别。

## ✨ 新功能特性

### 1. 真实AI识别
- 使用通义千问视觉模型分析食物图片
- 自动识别食物名称、类别、份量
- 智能估算营养成分（热量、蛋白质、碳水、脂肪）
- 提供置信度评分
- 生成个性化营养建议

### 2. 智能降级
- 如果未配置API Key，自动使用模拟识别
- 如果API调用失败，自动降级到模拟识别
- 保证功能始终可用

### 3. 识别流程
```
拍照/选择图片 
  ↓
转换为Base64
  ↓
调用通义千问视觉API
  ↓
解析AI返回的JSON结果
  ↓
计算实际营养成分
  ↓
显示识别结果
```

## 🔧 配置步骤

### 步骤1：获取通义千问API Key

1. 访问阿里云百炼平台：https://bailian.console.aliyun.com/
2. 登录/注册阿里云账号
3. 进入"API-KEY管理"
4. 创建新的API Key
5. 复制API Key（格式：sk-xxxxxx）

### 步骤2：配置API Key

打开文件：`utils/config.js`

找到这一行：
```javascript
const QWEN_API_KEY = 'YOUR_API_KEY_HERE';
```

替换为你的API Key：
```javascript
const QWEN_API_KEY = 'sk-your-actual-api-key-here';
```

### 步骤3：保存并重新编译

1. 保存config.js文件
2. 在微信开发者工具中按 `Ctrl + B` 重新编译
3. 打开食物识别页面测试

## 📱 使用方法

### 方法1：拍照识别（推荐）
1. 点击"📷 拍照识别"
2. 对准食物拍照
3. 等待AI识别（约2-5秒）
4. 查看识别结果和营养建议
5. 调整份量（如需要）
6. 点击"添加到饮食记录"

### 方法2：相册选择
1. 点击"🖼️ 相册选择"
2. 从相册选择食物照片
3. 等待AI识别
4. 查看结果并添加

### 方法3：手动选择
1. 点击"📝 手动选择食物"
2. 搜索或浏览食物列表
3. 选择对应的食物
4. 调整份量并添加

### 方法4：历史记录
1. 在识别历史中点击之前识别过的食物
2. 快速添加到饮食记录

## 🎨 拍照技巧

为了获得最佳识别效果：

### ✅ 推荐做法
- 让食物占据画面中心
- 保持光线充足
- 拍摄单一食物（不要混合多种食物）
- 从正上方或45度角拍摄
- 保持画面清晰，不要模糊
- 使用白色或浅色背景

### ❌ 避免
- 光线太暗或太亮
- 食物太小或太远
- 多种食物混在一起
- 画面模糊或晃动
- 复杂的背景

## 📊 识别结果说明

### 1. 食物信息
- **名称**：AI识别的食物名称
- **类别**：主食/肉类/蔬菜/水果/蛋奶/豆制品/快餐/其他
- **置信度**：AI对识别结果的信心程度（0-100%）

### 2. 份量调整
- 默认显示AI估算的份量
- 可以点击 +/- 按钮调整
- 营养成分会自动重新计算

### 3. 营养成分
- **卡路里**：总热量（千卡）
- **蛋白质**：克数
- **碳水化合物**：克数
- **脂肪**：克数

### 4. AI营养建议
- 根据食物特性生成的个性化建议
- 包括烹饪方式、搭配建议、食用时机等
- 帮助你做出更健康的饮食选择

## 💰 费用说明

### 通义千问视觉API定价
- **qwen-vl-plus模型**：
  - 输入：0.008元/千tokens
  - 输出：0.008元/千tokens
- 每次识别约消耗：0.01-0.02元
- 新用户通常有免费额度

### 成本优化建议
1. 使用识别历史快速添加常吃的食物
2. 对于熟悉的食物，使用手动选择
3. 只对不确定的食物使用AI识别
4. 合理利用免费额度

## 🔍 故障排查

### 问题1：识别失败
**可能原因**：
- API Key未配置或配置错误
- 网络连接问题
- API额度不足

**解决方法**：
1. 检查config.js中的API Key是否正确
2. 检查网络连接
3. 查看控制台错误信息
4. 系统会自动降级到模拟识别

### 问题2：识别不准确
**可能原因**：
- 照片质量不好
- 光线不足
- 食物不清晰

**解决方法**：
1. 重新拍照，注意拍照技巧
2. 使用手动选择功能
3. 调整识别后的份量

### 问题3：识别速度慢
**可能原因**：
- 网络速度慢
- 图片文件太大

**解决方法**：
1. 使用更快的网络
2. 系统已自动压缩图片
3. 等待识别完成（通常2-5秒）

## 📝 API响应示例

AI返回的JSON格式：
```json
{
  "name": "鸡胸肉",
  "category": "肉类",
  "portion": 150,
  "calories": 165,
  "protein": 31,
  "carbs": 0,
  "fat": 3.6,
  "confidence": 95.5,
  "suggestions": [
    "💪 高蛋白食物，适合增肌减脂",
    "✨ 低脂食物，减脂期推荐",
    "💡 优质蛋白来源，建议清蒸或水煮",
    "🥬 搭配蔬菜和适量主食更均衡"
  ]
}
```

## 🎯 最佳实践

### 早餐识别
- 拍摄鸡蛋、牛奶、面包等
- AI会根据时间智能推荐

### 午餐/晚餐识别
- 分别拍摄主食、肉类、蔬菜
- 每种食物单独识别更准确

### 加餐/零食识别
- 拍摄水果、坚果等
- 注意控制份量

## 🔐 安全说明

### API Key安全
- ⚠️ 不要将API Key分享给他人
- ⚠️ 不要将包含API Key的代码上传到公开仓库
- ⚠️ 定期更换API Key
- ⚠️ 监控API使用量，防止滥用

### 数据隐私
- 图片仅用于AI识别，不会被保存
- 识别结果存储在本地
- 不会上传到其他服务器

## 📚 相关文档

- [通义千问API文档](https://help.aliyun.com/zh/dashscope/)
- [视觉模型使用指南](https://help.aliyun.com/zh/dashscope/developer-reference/vl-plus-quick-start)
- [API定价说明](https://help.aliyun.com/zh/dashscope/developer-reference/tongyi-qianwen-metering-and-billing)

## 🎉 功能对比

| 功能 | 模拟识别 | AI识别 |
|------|---------|--------|
| 识别准确度 | 随机 | 高精度 |
| 份量估算 | 固定值 | 智能估算 |
| 营养成分 | 数据库查询 | AI分析 |
| 识别速度 | 2秒 | 2-5秒 |
| 需要配置 | 否 | 需要API Key |
| 费用 | 免费 | 按量计费 |

---

**准备好了吗？**
配置API Key后，就可以体验真实的AI食物识别功能了！🎉
