# 🎯 AI个性化系统说明

## 📋 功能概述

本次更新为小程序添加了完整的AI个性化推荐和情绪干预系统，包括：

### 1. 🍽️ 个性化食谱推荐系统

基于用户饮食历史和偏好，智能生成低卡、高满足感的替代食谱。

#### 核心功能
- **智能分析用户偏好**
  - 分析历史饮食记录
  - 提取食材偏好
  - 计算营养偏好（蛋白质、碳水、脂肪）
  - 识别卡路里范围

- **多维度推荐评分**
  - 食材匹配度（30分）
  - 营养匹配度（20分）
  - 难度偏好（10分）
  - 时间偏好（10分）
  - 新鲜度（10分）
  - 健康标签（10分）

- **个性化推荐理由**
  - 显示推荐原因（如"高蛋白"、"符合口味"）
  - 显示匹配度分数
  - 突出显示个性化标签

#### 使用方法
1. 进入"AI食谱生成"页面
2. 选择餐次类型（早餐/午餐/晚餐/加餐）
3. 可选填目标卡路里
4. 点击"生成AI食谱"
5. 系统会根据你的历史记录推荐最适合的食谱
6. 查看推荐理由和匹配度

#### 技术实现
- **文件**: `utils/recipePersonalizer.js`
- **算法**: 多维度评分系统
- **数据源**: 用户历史饮食记录（本地存储）

---

### 2. 🧠 情绪模式分析系统

通过情绪日记记录，分析情绪模式，识别触发因素，提供个性化干预。

#### 核心功能

##### A. 情绪频率分析
- 统计各种情绪出现的频率
- 识别最常见的情绪
- 显示情绪分布百分比

##### B. 时间模式分析
- 识别情绪高发时段（几点最容易出现负面情绪）
- 识别情绪高发日期（周几最容易情绪波动）
- 帮助用户了解情绪规律

##### C. 情绪性进食分析
- 检测情绪记录后2小时内的进食行为
- 计算情绪性进食频率
- 显示情绪与进食的关联

##### D. 触发因素识别
- 分析日记中的高频关键词
- 识别负面情绪的触发模式
- 按严重程度分类触发因素

##### E. 风险评估
- 评估情绪对饮食的影响程度
- 分为低/中/高三个风险等级
- 提供针对性建议

#### 使用方法
1. 进入"情绪记录"页面
2. 选择当前情绪（8种表情）
3. 可选填写简短日记
4. 点击"保存记录"
5. 记录3条以上后，点击"查看情绪模式分析"
6. 查看详细的分析报告

#### 分析报告内容
- 📊 最常见情绪及占比
- ⏰ 情绪高发时段和日期
- 🍽️ 情绪性进食次数和占比
- 🎯 触发因素列表
- ⚠️ 风险等级评估
- 💡 个性化建议

---

### 3. 🚨 智能干预系统

在检测到触发时刻时，自动推送个性化干预建议。

#### 触发条件
- 30分钟内记录了负面情绪（难过、压力、焦虑、生气、无聊）

#### 干预内容

##### 😢 难过时
- 深呼吸5分钟，专注于呼吸
- 听一首喜欢的音乐
- 给朋友打个电话
- 出门散步10分钟
- ⚠️ 避免高糖食物

##### 😰 压力时
- 做10分钟冥想或瑜伽
- 写下3件让你感激的事
- 做一些拉伸运动
- 喝一杯温水，慢慢品味
- ⚠️ 避免咖啡因和高脂食物

##### 😟 焦虑时
- 腹式呼吸：吸气4秒，呼气6秒
- 用冷水洗脸，刺激迷走神经
- 做一些简单的家务
- 看一段轻松的视频
- ⚠️ 避免刺激性食物

##### 😠 生气时
- 出去跑步或快走20分钟
- 做一些力量训练
- 写下愤怒的原因，然后撕掉
- 听激昂的音乐发泄
- ⚠️ 避免冲动进食

##### 😑 无聊时
- 做一件一直想做的事
- 学习新技能（5分钟即可）
- 整理房间或工作区
- 联系一个朋友聊天
- ⚠️ 无聊≠饿，先喝水再决定

#### 显示方式
- 进入情绪记录页面时自动检测
- 以醒目的橙色卡片显示
- 提供具体的行动建议
- 可以关闭提示

---

## 🔧 技术架构

### 文件结构
```
utils/
├── recipePersonalizer.js    # 食谱个性化推荐系统
└── emotionAnalyzer.js        # 情绪模式分析系统

pages/
├── recipe-generator/         # 食谱生成器页面
│   ├── recipe-generator.js
│   ├── recipe-generator.wxml
│   └── recipe-generator.wxss
└── emotion-log/              # 情绪记录页面
    ├── emotion-log.js
    ├── emotion-log.wxml
    └── emotion-log.wxss
```

### 核心类

#### RecipePersonalizer
```javascript
class RecipePersonalizer {
  getPersonalizedRecipes()      // 获取个性化推荐
  analyzeUserPreferences()      // 分析用户偏好
  calculateRecipeScore()        // 计算推荐分数
  generateRecommendationReason() // 生成推荐理由
  generateAlternatives()        // 生成替代方案
  calculateSatisfactionScore()  // 计算满足感分数
}
```

#### EmotionAnalyzer
```javascript
class EmotionAnalyzer {
  analyzePatterns()             // 分析情绪模式
  analyzeMoodFrequency()        // 分析情绪频率
  analyzeTimePatterns()         // 分析时间模式
  analyzeEmotionalEating()      // 分析情绪性进食
  identifyTriggers()            // 识别触发因素
  assessRisk()                  // 评估风险等级
  generateRecommendations()     // 生成建议
  checkTriggerMoment()          // 检测触发时刻
  generateIntervention()        // 生成干预建议
}
```

---

## 📊 数据流程

### 食谱推荐流程
```
用户历史数据 → 偏好分析 → 食谱筛选 → 评分排序 → 推荐展示
```

### 情绪分析流程
```
情绪记录 → 模式分析 → 风险评估 → 生成建议 → 智能干预
```

---

## 🎯 使用场景

### 场景1：想吃高热量食物
1. 打开"AI食谱生成"
2. 系统根据你的口味推荐低卡替代品
3. 查看推荐理由和营养信息
4. 选择满意的食谱

### 场景2：压力大想吃东西
1. 打开"情绪记录"
2. 选择"压力"情绪
3. 系统立即显示干预建议
4. 按照建议进行深呼吸或运动
5. 避免情绪性进食

### 场景3：了解情绪模式
1. 坚持记录情绪1周
2. 点击"查看情绪模式分析"
3. 了解自己的情绪规律
4. 识别触发因素
5. 在高发时段提前预防

---

## 💡 使用建议

### 食谱推荐
- ✅ 坚持记录饮食，系统会越来越了解你的口味
- ✅ 尝试推荐的食谱，帮助系统优化推荐
- ✅ 设置合理的卡路里目标
- ✅ 查看推荐理由，了解为什么适合你

### 情绪管理
- ✅ 每天记录情绪，建立习惯
- ✅ 写下简短日记，帮助识别触发因素
- ✅ 定期查看分析报告，了解自己
- ✅ 在负面情绪时立即查看干预建议
- ✅ 尝试建议的方法，找到适合自己的应对方式

---

## 🔒 隐私说明

- ✅ 所有数据存储在本地（wx.storage）
- ✅ 不会上传到服务器
- ✅ 完全离线可用
- ✅ 可随时删除记录

---

## 🚀 未来计划

### 食谱系统
- [ ] 集成通义千问API生成更多样化的食谱
- [ ] 添加食谱收藏功能
- [ ] 支持自定义食谱
- [ ] 添加购物清单功能

### 情绪系统
- [ ] 添加情绪趋势图表
- [ ] 支持导出情绪报告
- [ ] 添加情绪提醒功能
- [ ] 集成正念冥想指导

---

## 📝 更新日志

### v4.0 - AI个性化系统 (2025-12-27)
- ✅ 新增个性化食谱推荐系统
- ✅ 新增情绪模式分析系统
- ✅ 新增智能干预系统
- ✅ 优化用户体验
- ✅ 完善数据分析算法

---

## 🎉 总结

本次更新实现了完整的AI个性化推荐和情绪干预系统，帮助用户：

1. **更智能的食谱推荐** - 基于历史数据，推荐最适合的健康食谱
2. **深入的情绪分析** - 了解自己的情绪模式和触发因素
3. **及时的干预建议** - 在关键时刻提供具体的应对方法
4. **科学的减重支持** - 从饮食和情绪两方面全面支持减重目标

所有功能完全离线可用，数据安全可靠！
