# 🔐 登录注册功能说明

## ✅ 功能完成

小程序的登录和注册功能已完全开发完成！

## 🎯 功能特点

### 📱 登录功能
- ✅ 用户名密码登录
- ✅ 记住我选项
- ✅ 忘记密码提示
- ✅ Token自动管理
- ✅ 登录状态持久化

### ✨ 注册功能
- ✅ 用户名注册（3-20字符）
- ✅ 邮箱验证
- ✅ 密码强度要求（至少6字符）
- ✅ 确认密码验证
- ✅ 昵称设置（可选）
- ✅ 注册成功自动登录

### 🔒 安全特性
- ✅ JWT Token认证
- ✅ 密码加密传输
- ✅ Token过期自动跳转登录
- ✅ 401状态自动处理
- ✅ 安全的密码存储

### 🎨 界面设计
- ✅ 清新绿色主题
- ✅ Tab切换动画
- ✅ 表单验证提示
- ✅ 加载状态显示
- ✅ 响应式布局

## 📂 文件结构

```
pages/login/
├── login.js          # 登录注册逻辑
├── login.wxml        # 界面结构
└── login.wxss        # 样式设计

utils/
├── config.js         # API配置
└── request.js        # HTTP请求工具
```

## 🚀 使用方法

### 1. 启动后端服务

首先确保后端服务已启动：

```bash
cd 项目测试/backend
python main.py
```

后端服务默认运行在 `http://localhost:8000`

### 2. 配置API地址

如果需要修改API地址，编辑 `utils/config.js`：

```javascript
// 开发环境API地址
const DEV_API_BASE_URL = 'http://localhost:8000';

// 生产环境API地址
const PROD_API_BASE_URL = 'https://your-domain.com';
```

### 3. 访问登录页面

有两种方式访问登录页面：

#### 方式1：从账号管理进入
1. 打开小程序
2. 进入"我的"页面
3. 点击"账号管理"
4. 点击"登录账号"或"注册账号"

#### 方式2：直接跳转
```javascript
wx.navigateTo({
  url: '/pages/login/login?tab=login'  // 登录
});

wx.navigateTo({
  url: '/pages/login/login?tab=register'  // 注册
});
```

### 4. 注册新账号

1. 切换到"注册账号"Tab
2. 填写表单：
   - 用户名（必填，3-20字符）
   - 邮箱（必填，用于找回密码）
   - 昵称（可选）
   - 密码（必填，至少6字符）
   - 确认密码（必填）
3. 点击"注册账号"
4. 注册成功后自动登录

### 5. 登录账号

1. 切换到"登录账号"Tab
2. 输入用户名和密码
3. 可选择"记住我"
4. 点击"登录"
5. 登录成功后返回上一页

### 6. 跳过登录

如果暂时不想登录：
1. 点击底部"暂时跳过，稍后登录"
2. 数据将仅保存在本地
3. 无法同步到云端

## 🔧 API接口

### 注册接口
```
POST /api/users/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "name": "测试用户"
}

Response:
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "bearer"
}
```

### 登录接口
```
POST /api/auth/login
Content-Type: application/x-www-form-urlencoded

username=testuser&password=password123

Response:
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "bearer"
}
```

### 获取用户信息
```
GET /api/users/me
Authorization: Bearer <access_token>

Response:
{
  "id": 1,
  "username": "testuser",
  "email": "test@example.com",
  "name": "测试用户",
  "age": 30,
  "gender": "male",
  "height": 170,
  "current_weight": 70,
  ...
}
```

## 💾 数据存储

### 本地存储
- `access_token`: JWT访问令牌
- `userInfo`: 用户信息对象

### 检查登录状态
```javascript
const token = wx.getStorageSync('access_token');
const userInfo = wx.getStorageSync('userInfo');

if (token && userInfo) {
  // 已登录
} else {
  // 未登录
}
```

### 退出登录
```javascript
wx.removeStorageSync('access_token');
wx.removeStorageSync('userInfo');
```

## 🎯 登录后的功能

登录后可以使用以下功能：

1. **数据云端同步**
   - 饮食记录同步
   - 运动记录同步
   - 体重记录同步
   - 情绪记录同步

2. **多设备数据共享**
   - 在不同设备登录同一账号
   - 数据自动同步

3. **账号管理**
   - 修改密码
   - 修改邮箱
   - 查看登录历史
   - 账号安全设置

4. **社交功能**（未来）
   - 好友系统
   - 数据分享
   - 排行榜

## ⚠️ 注意事项

### 1. 网络连接
- 登录注册需要网络连接
- 确保后端服务正常运行
- 检查API地址配置正确

### 2. 密码安全
- 密码至少6个字符
- 建议使用字母+数字组合
- 不要使用过于简单的密码

### 3. Token管理
- Token默认30分钟过期
- 过期后需要重新登录
- Token存储在本地，请勿泄露

### 4. 数据同步
- 登录后数据会自动同步
- 本地数据不会丢失
- 可以手动触发同步

## 🐛 常见问题

### Q1: 无法连接到服务器
**A:** 检查以下几点：
1. 后端服务是否启动（`python main.py`）
2. API地址是否正确（`utils/config.js`）
3. 网络连接是否正常
4. 防火墙是否阻止连接

### Q2: 注册失败，提示用户名已存在
**A:** 该用户名已被注册，请更换其他用户名

### Q3: 登录失败，提示用户名或密码错误
**A:** 请检查：
1. 用户名是否正确
2. 密码是否正确
3. 是否已注册账号

### Q4: Token过期怎么办
**A:** Token过期后会自动跳转到登录页面，重新登录即可

### Q5: 忘记密码怎么办
**A:** 目前需要联系管理员重置密码，后续会添加邮箱找回功能

## 🔄 后续优化

- [ ] 邮箱验证码注册
- [ ] 手机号注册
- [ ] 忘记密码找回
- [ ] 第三方登录（微信、QQ）
- [ ] 生物识别登录（指纹、面容）
- [ ] 登录设备管理
- [ ] 登录历史查看
- [ ] 两步验证

## 📞 技术支持

如有问题，请查看：
- 后端API文档：`backend/README.md`
- 用户认证系统说明：`🔐用户认证系统说明.md`

---

**更新时间**: 2025-12-27
**版本**: v1.0
**状态**: ✅ 已完成
