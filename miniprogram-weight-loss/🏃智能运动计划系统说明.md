# 🏃 智能运动计划系统说明

## 📋 功能概述

智能运动计划系统是一个基于AI的个性化运动方案生成器，能够根据用户的体能水平、时间安排、运动偏好和减重阶段自动生成周计划，并在用户连续错过训练时提供"最小可行方案"，帮助用户重新建立运动习惯。

---

## ✨ 核心功能

### 1. 🎯 个性化计划生成

#### 输入参数

**体能水平**（3个等级）：
- **初学者**：刚开始运动，体能较弱
- **中级**：有一定运动基础
- **高级**：经常运动，体能较好

**可用时间**（5个选项）：
- 15分钟
- 20分钟
- 30分钟
- 45分钟
- 60分钟

**运动偏好**（可多选）：
- 跑步
- 快走
- 跳绳
- 游泳
- 骑车
- 瑜伽

**可用设备**（可多选）：
- 跳绳
- 瑜伽垫
- 哑铃
- 自行车

#### 生成逻辑

系统会根据以下因素生成计划：

1. **体能水平** → 确定训练强度和频率
2. **可用时间** → 筛选合适时长的运动
3. **运动偏好** → 优先选择喜欢的运动
4. **可用设备** → 筛选可执行的运动
5. **减重阶段** → 调整训练策略

#### 减重阶段识别

系统自动识别3个阶段：

**初始期（Initial）**：
- 刚开始减重
- 体重稳定下降
- 策略：建立习惯，稳步推进

**平台期（Plateau）**：
- 最近7天体重变化<0.5kg
- 遇到瓶颈
- 策略：增加强度，突破平台期

**维持期（Maintenance）**：
- 接近目标体重（±2kg）
- 保持成果
- 策略：维持运动习惯

---

### 2. 📅 周计划生成

#### 训练频率

根据体能水平确定每周训练天数：

| 体能水平 | 训练天数 | 平台期增加 |
|---------|---------|-----------|
| 初学者   | 3天/周  | +1天      |
| 中级     | 4天/周  | +1天      |
| 高级     | 5天/周  | +1天      |

#### 训练安排

**训练日分布**：
- 避免连续3天训练
- 合理安排休息日
- 有氧和力量交替

**示例（中级，4天/周）**：
- 周一：有氧训练
- 周二：休息
- 周三：力量训练
- 周四：休息
- 周五：有氧训练
- 周六：休息
- 周日：力量训练

#### 单日计划结构

每天的训练包含3个部分：

**1. 热身（5分钟）**
- 动态拉伸
- 活动关节
- 消耗约10卡

**2. 主要训练（根据可用时间）**

**有氧日**：
- 快走/慢跑/跑步/跳绳等
- 持续时间：15-60分钟
- 消耗：5-13卡/分钟

**力量日**：
- 深蹲/俯卧撑/平板支撑等
- 3-4个动作
- 每个动作10-20分钟
- 消耗：4-7卡/分钟

**3. 放松（5分钟）**
- 静态拉伸
- 放松肌肉
- 消耗约10卡

---

### 3. 📊 预期效果计算

系统会计算并显示：

**训练天数**：
- 每周实际训练天数

**总消耗**：
- 每周总卡路里消耗

**平均消耗**：
- 每次训练平均消耗

**预期减重**：
```
预期减重(kg) = 总消耗(卡) / 7700
```
（1kg脂肪 ≈ 7700卡）

**示例**：
- 训练天数：4天/周
- 总消耗：1200卡/周
- 平均消耗：300卡/次
- 预期减重：0.16kg/周

---

### 4. 🚨 错过检测系统

#### 检测机制

系统每天自动检测：
1. 获取过去7天的日期
2. 对比计划和实际记录
3. 统计错过的训练日
4. 计算连续错过天数

#### 触发条件

当满足以下条件时触发最小可行方案：
- **连续错过 ≥ 2天**

#### 检测示例

```
计划：周一、周三、周五训练
实际：周一完成，周三、周五未完成
结果：连续错过2天 → 触发最小方案
```

---

### 5. 💪 最小可行方案

#### 设计理念

**核心思想**：
- 不要求完美，只要开始
- 降低心理门槛
- 重建运动习惯
- 避免自责和放弃

**方案原则**：
- 极短时间（1-5分钟）
- 超简单动作
- 无需设备
- 随时随地可做

#### 三级方案

根据连续错过天数提供不同难度：

**Level 1：标准5分钟方案**（错过0-1天）
```
1. 原地踏步 - 2分钟（热身）
2. 深蹲 - 2分钟（10次）
3. 拉伸 - 1分钟（放松）

总时长：5分钟
消耗：约25卡
```

**Level 2：超简单3分钟方案**（错过2-3天）
```
1. 原地踏步 - 1分钟（热身）
2. 深蹲 - 1分钟（5次）
3. 拉伸 - 1分钟（放松）

总时长：3分钟
消耗：约15卡
```

**Level 3：极简1分钟方案**（错过4天以上）
```
1. 深蹲 - 1分钟（5次，慢慢做）

总时长：1分钟
消耗：约5卡
```

#### 鼓励语

根据错过天数提供不同的鼓励：

- **0天**："今天开始新的一天！即使只运动5分钟也很棒！"
- **1天**："没关系，每个人都会有状态不好的时候。今天试试5分钟方案？"
- **2天**："我理解坚持很难。要不要试试超简单的3分钟方案？"
- **3天+**："重新开始永远不晚！1分钟的运动也比不运动强100倍！"

#### 完成后提示

```
🎉 太棒了！你完成了X分钟的运动！

这是一个很好的开始，明天继续加油！

💡 提示：
- 完成后可以继续，也可以就此结束
- 不要求完美，只要开始就是胜利
- 每一次运动都是进步
```

---

### 6. 🔄 自动调整系统

#### 调整时机

- 每周自动检查
- 用户手动触发
- 连续错过后重新生成

#### 调整依据

**1. 完成率**
```
完成率 = 实际完成天数 / 计划训练天数
```

- **<50%**：降低难度
- **50-90%**：保持不变
- **>90%**：适当增加难度

**2. 体重变化**
```
体重变化 = 本周体重 - 上周体重
```

- **≥0kg**：增加强度/频率
- **<0kg**：保持当前计划

**3. 用户反馈**
- 太难 → 降低难度
- 太简单 → 增加难度
- 时间不够 → 缩短时长

#### 调整策略

**降低难度**：
- 减少训练天数
- 降低运动强度
- 缩短训练时长
- 选择更简单的动作

**增加难度**：
- 增加训练天数
- 提高运动强度
- 延长训练时长
- 选择更有挑战的动作

---

## 🎮 使用流程

### 首次使用

```
1. 打开"智能运动计划"
   ↓
2. 选择体能水平（初学者/中级/高级）
   ↓
3. 选择可用时间（15-60分钟）
   ↓
4. 选择运动偏好（可多选）
   ↓
5. 选择可用设备（可多选）
   ↓
6. 点击"生成AI运动计划"
   ↓
7. 查看周计划和预期效果
   ↓
8. 点击某天查看详细训练内容
   ↓
9. 开始训练
```

### 日常使用

```
1. 打开计划页面
   ↓
2. 查看今天的训练安排
   ↓
3. 点击查看详细内容
   ↓
4. 开始训练
   ↓
5. 完成后记录
```

### 错过训练后

```
1. 打开计划页面
   ↓
2. 系统自动检测错过情况
   ↓
3. 弹出最小可行方案提示
   ↓
4. 查看方案详情
   ↓
5. 选择"开始"或"稍后"
   ↓
6. 完成最小方案
   ↓
7. 重建运动习惯
```

---

## 💡 运动数据库

### 有氧运动（8种）

| 运动 | 强度 | 消耗 | 时长选项 | 设备 |
|-----|------|------|---------|------|
| 快走 | 低 | 5卡/分 | 20/30/45/60分 | 无 |
| 慢跑 | 中 | 8卡/分 | 20/30/45分 | 无 |
| 跑步 | 高 | 12卡/分 | 15/20/30分 | 无 |
| 跳绳 | 高 | 13卡/分 | 10/15/20分 | 跳绳 |
| 游泳 | 中 | 10卡/分 | 30/45/60分 | 泳池 |
| 骑车 | 中 | 7卡/分 | 30/45/60分 | 自行车 |
| 爬楼梯 | 中 | 9卡/分 | 10/15/20分 | 无 |
| 跳操 | 中 | 8卡/分 | 20/30/45分 | 无 |

### 力量训练（6种）

| 运动 | 强度 | 消耗 | 时长选项 | 次数 | 设备 |
|-----|------|------|---------|------|------|
| 深蹲 | 中 | 6卡/分 | 10/15/20分 | 15/20/30次 | 无 |
| 俯卧撑 | 中 | 7卡/分 | 10/15/20分 | 10/15/20次 | 无 |
| 平板支撑 | 中 | 5卡/分 | 5/10/15分 | - | 无 |
| 卷腹 | 低 | 4卡/分 | 10/15/20分 | 20/30/40次 | 无 |
| 弓步蹲 | 中 | 6卡/分 | 10/15/20分 | 15/20/30次 | 无 |
| 臀桥 | 低 | 5卡/分 | 10/15/20分 | 20/30/40次 | 无 |

### 拉伸放松（3种）

| 运动 | 强度 | 消耗 | 时长选项 | 设备 |
|-----|------|------|---------|------|
| 瑜伽 | 低 | 3卡/分 | 15/20/30分 | 瑜伽垫 |
| 拉伸 | 低 | 2卡/分 | 10/15/20分 | 无 |
| 普拉提 | 低 | 4卡/分 | 20/30/45分 | 瑜伽垫 |

---

## 🎯 使用场景

### 场景1：新手开始运动

**情况**：从未运动过，想开始减重

**操作**：
1. 选择"初学者"
2. 选择"20分钟"
3. 选择"快走"
4. 不选设备
5. 生成计划

**结果**：
- 每周3天训练
- 每次20分钟快走
- 低强度，易坚持

### 场景2：遇到平台期

**情况**：体重2周没变化

**操作**：
1. 系统自动识别平台期
2. 增加训练天数（3→4天）
3. 提高运动强度
4. 增加力量训练

**结果**：
- 突破平台期
- 体重重新下降

### 场景3：连续错过训练

**情况**：工作忙，连续3天没运动

**操作**：
1. 打开计划页面
2. 系统弹出提示
3. 查看3分钟方案
4. 完成超简单训练

**结果**：
- 重建运动习惯
- 避免完全放弃
- 逐步恢复正常

### 场景4：时间不够

**情况**：原计划30分钟，现在只有15分钟

**操作**：
1. 点击"调整计划"
2. 修改可用时间为15分钟
3. 重新生成计划

**结果**：
- 缩短训练时长
- 保持训练频率
- 适应新的时间安排

---

## 🔧 技术实现

### 核心算法

#### 1. 强度确定算法

```javascript
determineIntensity(fitnessLevel, weightLossStage) {
  const intensityMap = {
    beginner: {
      initial: 'low',
      plateau: 'medium',
      maintenance: 'low'
    },
    intermediate: {
      initial: 'medium',
      plateau: 'high',
      maintenance: 'medium'
    },
    advanced: {
      initial: 'high',
      plateau: 'high',
      maintenance: 'medium'
    }
  };
  
  return intensityMap[fitnessLevel][weightLossStage];
}
```

#### 2. 运动筛选算法

```javascript
selectExercises(fitnessLevel, preferences, time, equipment) {
  // 1. 强度筛选
  exercises = exercises.filter(e => 
    matchIntensity(e.intensity, fitnessLevel)
  );
  
  // 2. 设备筛选
  exercises = exercises.filter(e => 
    e.equipment === 'none' || equipment.includes(e.equipment)
  );
  
  // 3. 时间筛选
  exercises = exercises.filter(e => 
    e.duration.some(d => d <= time)
  );
  
  // 4. 偏好优先
  if (preferences.length > 0) {
    preferred = exercises.filter(e => 
      preferences.includes(e.name)
    );
    if (preferred.length > 0) {
      exercises = preferred;
    }
  }
  
  return exercises;
}
```

#### 3. 错过检测算法

```javascript
detectMissedWorkouts() {
  const last7Days = getLast7Days();
  const missedDays = [];
  
  last7Days.forEach(day => {
    const planned = getPlan(day);
    const actual = getLog(day);
    
    if (planned && !planned.isRestDay && !actual) {
      missedDays.push(day);
    }
  });
  
  const consecutiveMissed = countConsecutive(missedDays);
  
  return {
    missedCount: missedDays.length,
    consecutiveMissed
  };
}
```

#### 4. 最小方案生成算法

```javascript
createMinimalPlan(consecutiveMissed) {
  const level = Math.min(Math.floor(consecutiveMissed / 2), 2);
  
  const plans = [
    { duration: 5, activities: [...] },  // Level 0
    { duration: 3, activities: [...] },  // Level 1
    { duration: 1, activities: [...] }   // Level 2
  ];
  
  return plans[level];
}
```

---

## 📊 数据结构

### 运动计划

```javascript
{
  weeklyPlan: [
    {
      day: '周一',
      dayIndex: 1,
      isRestDay: false,
      focus: '有氧训练',
      totalTime: 30,
      totalCalories: 240,
      activities: [
        {
          name: '热身',
          type: 'warmup',
          duration: 5,
          calories: 10
        },
        {
          name: '慢跑',
          type: 'cardio',
          duration: 20,
          calories: 160,
          intensity: 'medium'
        },
        {
          name: '拉伸',
          type: 'cooldown',
          duration: 5,
          calories: 10
        }
      ]
    },
    // ... 其他6天
  ],
  expectedResults: {
    trainingDays: 4,
    totalCalories: 1200,
    avgCaloriesPerDay: 300,
    expectedWeightLoss: 0.16
  },
  intensity: {
    level: 'medium',
    description: '中等强度，稳步减重'
  },
  createdAt: 1703664000000,
  nextAdjustment: 1704268800000
}
```

### 最小方案

```javascript
{
  reasons: [
    {
      type: 'motivation',
      description: '可能缺乏动力',
      suggestion: '设定小目标，从5分钟开始'
    }
  ],
  minimalPlan: {
    name: '超简单3分钟方案',
    duration: 3,
    activities: [
      { name: '原地踏步', duration: 1, description: '热身' },
      { name: '深蹲', duration: 1, description: '5次' },
      { name: '拉伸', duration: 1, description: '放松' }
    ],
    calories: 15,
    message: '不要求完美，只要开始就是胜利！',
    nextStep: '完成后可以继续，也可以就此结束'
  },
  encouragement: '我理解坚持很难。要不要试试超简单的3分钟方案？'
}
```

---

## 🚀 未来计划

### 短期（1-2周）
- [ ] 添加运动视频教程
- [ ] 支持自定义运动
- [ ] 添加运动提醒功能
- [ ] 集成微信运动数据

### 中期（1-2月）
- [ ] 添加运动打卡功能
- [ ] 支持好友PK
- [ ] 添加运动成就系统
- [ ] 集成通义千问生成个性化建议

### 长期（3-6月）
- [ ] 接入智能手环数据
- [ ] 实时心率监测
- [ ] AI动作识别
- [ ] 虚拟教练指导

---

## 💡 使用建议

### 新手建议
1. ✅ 从初学者级别开始
2. ✅ 选择15-20分钟时长
3. ✅ 选择简单的运动（快走）
4. ✅ 先建立习惯，再增加强度

### 进阶建议
1. ✅ 根据完成情况调整难度
2. ✅ 尝试不同类型的运动
3. ✅ 有氧和力量结合
4. ✅ 定期查看预期效果

### 坚持建议
1. ✅ 不要求完美，只要开始
2. ✅ 错过了就用最小方案
3. ✅ 每次运动都是进步
4. ✅ 关注过程，不只是结果

---

## 🎉 总结

智能运动计划系统通过：

1. **个性化生成** - 根据体能、时间、偏好定制计划
2. **自动调整** - 根据完成情况和体重变化优化方案
3. **最小方案** - 在错过训练时提供超简单的重启方案
4. **人性化设计** - 不要求完美，降低心理门槛

帮助用户建立和保持运动习惯，实现健康减重目标！

**核心理念**：不要求完美，只要开始就是胜利！
