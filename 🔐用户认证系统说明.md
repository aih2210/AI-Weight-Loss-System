# ğŸ” ç”¨æˆ·è®¤è¯ç³»ç»Ÿè¯´æ˜

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. åç«¯è®¤è¯ç³»ç»Ÿ
- âœ… **ç”¨æˆ·æ¨¡å‹**ï¼šå®Œæ•´çš„ç”¨æˆ·æ•°æ®æ¨¡å‹ï¼ˆSQLAlchemyï¼‰
- âœ… **æ•°æ®åº“ç®¡ç†**ï¼šSQLiteæ•°æ®åº“ï¼ˆå¯åˆ‡æ¢PostgreSQLï¼‰
- âœ… **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨
- âœ… **JWTè®¤è¯**ï¼šåŸºäºTokençš„èº«ä»½éªŒè¯
- âœ… **ç”¨æˆ·æ³¨å†Œ**ï¼šé‚®ç®±éªŒè¯ã€ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- âœ… **ç”¨æˆ·ç™»å½•**ï¼šå®‰å…¨çš„ç™»å½•éªŒè¯
- âœ… **ç”¨æˆ·ä¿¡æ¯ç®¡ç†**ï¼šè·å–å’Œæ›´æ–°ç”¨æˆ·èµ„æ–™

### 2. å‰ç«¯ç™»å½•ç•Œé¢
- âœ… **ç°ä»£åŒ–è®¾è®¡**ï¼šæ¸…æ–°ç»¿è‰²ä¸»é¢˜ï¼Œå“åº”å¼å¸ƒå±€
- âœ… **ç™»å½•/æ³¨å†Œåˆ‡æ¢**ï¼šTabåˆ‡æ¢ï¼Œæµç•…åŠ¨ç”»
- âœ… **è¡¨å•éªŒè¯**ï¼šå‰ç«¯éªŒè¯ï¼Œå‹å¥½æç¤º
- âœ… **é”™è¯¯å¤„ç†**ï¼šæ¸…æ™°çš„é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯
- âœ… **Tokenç®¡ç†**ï¼šè‡ªåŠ¨ä¿å­˜å’Œä½¿ç”¨è®¿é—®ä»¤ç‰Œ

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ main.py                    # ä¸»å…¥å£ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ database.py                # æ•°æ®åº“é…ç½®ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ auth.py                    # è®¤è¯é€»è¾‘ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ models/
â”‚   â””â”€â”€ user.py               # ç”¨æˆ·æ¨¡å‹ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ api/routes/
â”‚   â””â”€â”€ user.py               # ç”¨æˆ·APIï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ requirements.txt          # ä¾èµ–åŒ…ï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ start-server.bat          # å¯åŠ¨è„šæœ¬ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ weight_loss.db            # SQLiteæ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

frontend/
â””â”€â”€ login.html                # ç™»å½•ç•Œé¢ï¼ˆæ–°å¢ï¼‰
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
pip install -r requirements.txt
```

### 2. å¯åŠ¨æœåŠ¡å™¨

**æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
åŒå‡» start-server.bat
```

**æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨**
```bash
cd backend
python main.py
```

### 3. è®¿é—®ç³»ç»Ÿ

- **ç™»å½•é¡µé¢**ï¼šhttp://localhost:8000/login.html
- **APIæ–‡æ¡£**ï¼šhttp://localhost:8000/docs
- **ä¸»é¡µ**ï¼šhttp://localhost:8000/index.html

---

## ğŸ”‘ APIæ¥å£

### 1. ç”¨æˆ·æ³¨å†Œ

**æ¥å£**ï¼š`POST /api/users/register`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "name": "æµ‹è¯•ç”¨æˆ·"
}
```

**å“åº”**ï¼š
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

### 2. ç”¨æˆ·ç™»å½•

**æ¥å£**ï¼š`POST /api/users/login`

**è¯·æ±‚ä½“**ï¼ˆè¡¨å•æ ¼å¼ï¼‰ï¼š
```
username=testuser
password=password123
```

**å“åº”**ï¼š
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**æ¥å£**ï¼š`GET /api/users/me`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <access_token>
```

**å“åº”**ï¼š
```json
{
  "id": 1,
  "username": "testuser",
  "email": "test@example.com",
  "name": "æµ‹è¯•ç”¨æˆ·",
  "age": null,
  "gender": null,
  "height": null,
  "current_weight": null,
  "start_weight": null,
  "target_weight": null,
  "activity_level": null,
  "daily_calorie_target": 1500,
  "daily_exercise_target": 300
}
```

### 4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£**ï¼š`PUT /api/users/me`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <access_token>
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "name": "æ–°åå­—",
  "age": 25,
  "gender": "male",
  "height": 175,
  "current_weight": 70,
  "start_weight": 75,
  "target_weight": 65,
  "activity_level": "moderate"
}
```

---

## ğŸ¨ ç™»å½•ç•Œé¢ç‰¹æ€§

### è®¾è®¡é£æ ¼
- **æ¸…æ–°ç»¿è‰²ä¸»é¢˜**ï¼šä¸å°ç¨‹åºä¿æŒä¸€è‡´
- **å·¦å³åˆ†æ å¸ƒå±€**ï¼šå·¦ä¾§å±•ç¤ºç‰¹æ€§ï¼Œå³ä¾§ç™»å½•è¡¨å•
- **å“åº”å¼è®¾è®¡**ï¼šç§»åŠ¨ç«¯è‡ªåŠ¨åˆ‡æ¢ä¸ºä¸Šä¸‹å¸ƒå±€

### åŠŸèƒ½ç‰¹æ€§
1. **Tabåˆ‡æ¢**ï¼šç™»å½•/æ³¨å†Œæ— ç¼åˆ‡æ¢
2. **è¡¨å•éªŒè¯**ï¼š
   - ç”¨æˆ·åå¿…å¡«
   - é‚®ç®±æ ¼å¼éªŒè¯
   - å¯†ç é•¿åº¦éªŒè¯ï¼ˆè‡³å°‘6ä½ï¼‰
   - ç¡®è®¤å¯†ç åŒ¹é…éªŒè¯
3. **é”™è¯¯æç¤º**ï¼š
   - ç”¨æˆ·åå·²å­˜åœ¨
   - é‚®ç®±å·²æ³¨å†Œ
   - å¯†ç é”™è¯¯
   - ç½‘ç»œé”™è¯¯
4. **æˆåŠŸæç¤º**ï¼š
   - æ³¨å†ŒæˆåŠŸ
   - ç™»å½•æˆåŠŸ
   - è‡ªåŠ¨è·³è½¬

### ç”¨æˆ·ä½“éªŒ
- âœ… è¾“å…¥æ¡†èšç„¦é«˜äº®
- âœ… æŒ‰é’®æ‚¬åœæ•ˆæœ
- âœ… åŠ è½½çŠ¶æ€æç¤º
- âœ… è‡ªåŠ¨ä¿å­˜Token
- âœ… è‡ªåŠ¨è·³è½¬ä¸»é¡µ

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. å¯†ç å®‰å…¨
- **bcryptåŠ å¯†**ï¼šä½¿ç”¨bcryptç®—æ³•åŠ å¯†å¯†ç 
- **ç›å€¼éšæœº**ï¼šæ¯ä¸ªå¯†ç ä½¿ç”¨ä¸åŒçš„ç›å€¼
- **ä¸å¯é€†**ï¼šå¯†ç å“ˆå¸Œä¸å¯åå‘è§£å¯†

### 2. Tokenå®‰å…¨
- **JWTæ ‡å‡†**ï¼šä½¿ç”¨JSON Web Tokenæ ‡å‡†
- **è¿‡æœŸæ—¶é—´**ï¼šé»˜è®¤30åˆ†é’Ÿè¿‡æœŸ
- **ç­¾åéªŒè¯**ï¼šé˜²æ­¢Tokenè¢«ç¯¡æ”¹

### 3. APIå®‰å…¨
- **è®¤è¯ä¸­é—´ä»¶**ï¼šæ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£è‡ªåŠ¨éªŒè¯Token
- **ç”¨æˆ·éš”ç¦»**ï¼šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **CORSé…ç½®**ï¼šè·¨åŸŸè¯·æ±‚å®‰å…¨æ§åˆ¶

---

## ğŸ’¾ æ•°æ®åº“

### é»˜è®¤é…ç½®
- **ç±»å‹**ï¼šSQLite
- **æ–‡ä»¶**ï¼š`weight_loss.db`
- **ä½ç½®**ï¼šbackendç›®å½•

### åˆ‡æ¢åˆ°PostgreSQL

1. å®‰è£…PostgreSQLé©±åŠ¨ï¼š
```bash
pip install psycopg2-binary
```

2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
set DATABASE_URL=postgresql://user:password@localhost/weight_loss
```

3. é‡å¯æœåŠ¡å™¨

### ç”¨æˆ·è¡¨ç»“æ„

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    username VARCHAR UNIQUE NOT NULL,
    email VARCHAR UNIQUE NOT NULL,
    hashed_password VARCHAR NOT NULL,
    name VARCHAR,
    age INTEGER,
    gender VARCHAR,
    height FLOAT,
    current_weight FLOAT,
    start_weight FLOAT,
    target_weight FLOAT,
    activity_level VARCHAR,
    daily_calorie_target INTEGER DEFAULT 1500,
    daily_exercise_target INTEGER DEFAULT 300,
    is_active BOOLEAN DEFAULT TRUE,
    is_verified BOOLEAN DEFAULT FALSE,
    created_at DATETIME,
    updated_at DATETIME,
    last_login DATETIME
);
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•æ³¨å†Œ
1. è®¿é—® http://localhost:8000/login.html
2. ç‚¹å‡»"æ³¨å†Œ"æ ‡ç­¾
3. å¡«å†™ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
4. ç‚¹å‡»"æ³¨å†Œ"æŒ‰é’®
5. åº”è¯¥çœ‹åˆ°"æ³¨å†ŒæˆåŠŸ"æç¤ºå¹¶è·³è½¬

### 2. æµ‹è¯•ç™»å½•
1. è®¿é—® http://localhost:8000/login.html
2. å¡«å†™ç”¨æˆ·åå’Œå¯†ç 
3. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
4. åº”è¯¥çœ‹åˆ°"ç™»å½•æˆåŠŸ"æç¤ºå¹¶è·³è½¬

### 3. æµ‹è¯•API
1. è®¿é—® http://localhost:8000/docs
2. ç‚¹å‡»"Try it out"æµ‹è¯•å„ä¸ªæ¥å£
3. ä½¿ç”¨è·å–çš„Tokenæµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£

---

## ğŸ”§ é…ç½®é€‰é¡¹

### JWTé…ç½®ï¼ˆauth.pyï¼‰

```python
SECRET_KEY = "your-secret-key-change-in-production"  # ç”Ÿäº§ç¯å¢ƒå¿…é¡»æ›´æ”¹
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 30  # Tokenè¿‡æœŸæ—¶é—´
```

### æ•°æ®åº“é…ç½®ï¼ˆdatabase.pyï¼‰

```python
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./weight_loss.db")
```

### CORSé…ç½®ï¼ˆmain.pyï¼‰

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶å…·ä½“åŸŸå
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### JavaScriptå‰ç«¯è°ƒç”¨

```javascript
// æ³¨å†Œ
async function register() {
    const response = await fetch('http://localhost:8000/api/users/register', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            username: 'testuser',
            email: 'test@example.com',
            password: 'password123'
        })
    });
    const data = await response.json();
    localStorage.setItem('access_token', data.access_token);
}

// ç™»å½•
async function login() {
    const response = await fetch('http://localhost:8000/api/users/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            username: 'testuser',
            password: 'password123'
        })
    });
    const data = await response.json();
    localStorage.setItem('access_token', data.access_token);
}

// è·å–ç”¨æˆ·ä¿¡æ¯
async function getUserInfo() {
    const token = localStorage.getItem('access_token');
    const response = await fetch('http://localhost:8000/api/users/me', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    });
    const data = await response.json();
    console.log(data);
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
**é—®é¢˜**ï¼šå¯åŠ¨æ—¶æç¤ºæ•°æ®åº“é”™è¯¯

**è§£å†³**ï¼š
```bash
# åˆ é™¤æ—§æ•°æ®åº“
del weight_loss.db
# é‡æ–°å¯åŠ¨æœåŠ¡å™¨
python main.py
```

### 2. TokenéªŒè¯å¤±è´¥
**é—®é¢˜**ï¼šAPIè¿”å›401é”™è¯¯

**è§£å†³**ï¼š
- æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰
- æ£€æŸ¥Tokenæ ¼å¼ï¼š`Bearer <token>`
- é‡æ–°ç™»å½•è·å–æ–°Token

### 3. CORSé”™è¯¯
**é—®é¢˜**ï¼šæµè§ˆå™¨æç¤ºè·¨åŸŸé”™è¯¯

**è§£å†³**ï¼š
- ç¡®ä¿åç«¯CORSé…ç½®æ­£ç¡®
- ä½¿ç”¨ç›¸åŒåŸŸåè®¿é—®å‰åç«¯
- æˆ–é…ç½®å…è®¸çš„æº

### 4. å¯†ç åŠ å¯†é”™è¯¯
**é—®é¢˜**ï¼šç™»å½•æ—¶å¯†ç éªŒè¯å¤±è´¥

**è§£å†³**ï¼š
```bash
# é‡æ–°å®‰è£…passlib
pip install --upgrade passlib[bcrypt]
```

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. å®‰å…¨é…ç½®

```python
# æ›´æ”¹å¯†é’¥
SECRET_KEY = os.getenv("SECRET_KEY", "your-very-secure-secret-key")

# é™åˆ¶CORS
allow_origins=["https://yourdomain.com"]

# ä½¿ç”¨HTTPS
# é…ç½®SSLè¯ä¹¦
```

### 2. æ•°æ®åº“è¿ç§»

```bash
# ä½¿ç”¨PostgreSQL
DATABASE_URL=postgresql://user:password@localhost/weight_loss

# è¿è¡Œè¿ç§»
alembic upgrade head
```

### 3. ä½¿ç”¨Gunicorn

```bash
pip install gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker
```

---

## ğŸ“Š ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸ
- [ ] é‚®ç®±éªŒè¯åŠŸèƒ½
- [ ] å¿˜è®°å¯†ç åŠŸèƒ½
- [ ] ç”¨æˆ·å¤´åƒä¸Šä¼ 
- [ ] ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€QQï¼‰

### ä¸­æœŸ
- [ ] ç”¨æˆ·æƒé™ç®¡ç†
- [ ] ç®¡ç†å‘˜åå°
- [ ] æ•°æ®å¤‡ä»½æ¢å¤
- [ ] æ—¥å¿—å®¡è®¡

### é•¿æœŸ
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] åˆ†å¸ƒå¼éƒ¨ç½²
- [ ] å¾®æœåŠ¡æ¶æ„
- [ ] å®¹å™¨åŒ–éƒ¨ç½²

---

**ç‰ˆæœ¬**ï¼šv1.0
**å®Œæˆæ—¶é—´**ï¼š2025-12-27
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶æµ‹è¯•
